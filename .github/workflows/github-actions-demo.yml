name: GitHub Actions Demo
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - name: Print the working directory
      - run: echo "PWD $(pwd)"
      - run: echo "NPM Version $(npm version)"
      - run: echo "AWS CLI Version $(aws --version)"
      - run: |
          echo "GIT_BUILD=$GITHUB_RUN_NUMBER-$GITHUB_RUN_ID" >> $GITHUB_ENV
          echo "GIT_HASH=$(git log --pretty=format:"%h %ad" -1)" >> $GITHUB_ENV
      - name: Use the value
        run: |
          echo "GIT_HASH: ${{ env.GIT_HASH }}" 
          echo "BUILD: ${{ env.GIT_BUILD }}"
      - run: |
          date >> generated.txt
          echo "$GITHUB_RUN_NUMBER" >> generated.txt
          echo "$GITHUB_RUN_ID" >> generated.txt
          echo "GIT_HASH $(git log --pretty=format:"%h %ad" -1)" >> generated.txt
          echo "GIT_SHA $(git log --pretty=format:"%h" -1)" >> generated.txt
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "generated"
          git push
      - name: Generate build number
        uses: einaregilsson/build-number@v3
        with:
          token: ${{secrets.github_token}}        
      - name: Print new build number
        run: echo "Build number is $BUILD_NUMBER"
      - name: Print Git Hub Run ID
        run: echo "The GITHUB_RUN_ID $GITHUB_RUN_ID"
      - name: Print Git Hub Run Number 
        run: echo "The GITHUB_RUN_NUMBER $GITHUB_RUN_NUMBER"
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
      - name: Branch name
        run: echo running on branch ${GITHUB_REF##*/}
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
  debug:
    name: Debug
    runs-on: ubuntu-latest
    steps:
      - name: Dump env
        run: env | sort
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"    
